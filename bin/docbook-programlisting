#! /usr/bin/perl

use strict;
use Getopt::Long;

{
    my ($lineno, $line);

    my %options = ();
    GetOptions(\%options, "lines!", "xml-declaration!", "l!", "d!", "n!", "no-entities!");

    $lineno = 0;

    if ($options{'xml-declaration'} || $options{'d'})
    {
        print '<?xml version="1.0" encoding="ISO8859-1"?>' . "\n";
    }

    while (my $line = <>)
    {
        $lineno++;

        if ($ARGV =~ /\.s$/)
        {
            #
            # Expand tabs to 8 spaces
            #
            $line =~ s/\t/        /g;
        }
        else
        {
            #
            # Expand tabs to 4 spaces
            #
            $line =~ s/\t/    /g;
        }

        if ($options{'lines'} || $options{'l'})
        {
            # Line numbering
            my $linenumber = sprintf("%4u  ", $lineno);
            $line =~ s/^/$linenumber/;
        }

        if (! ($options{"no-entities"} || $options{"n"}))
        {
            #
            # Escape special characters
            #
            $line =~ s/&/&amp;/g;
            $line =~ s/</&lt;/g;
            $line =~ s/>/&gt;/g;
        #	$line =~ s/---/&mdash;/g;
        #	$line =~ s/--/&ndash;/g;
        }

        print $line;
    }
}
