#! /bin/sh -e

# Record the commit id in .git/CHERRY_COMMIT, and call git-cherry-pick without
# actually committing.  If a conflict occurs, resolve it and invoke this script
# with --continue.  The commit log is then fed to git commit.
#
# FIXME find the root repository directory

cherry_commit=$(git rev-parse --git-dir)/CHERRY_COMMIT

if test "$1" = "--continue" ; then
    cont=1
    commit=$(cat $cherry_commit)
else
    cont=0
    commit=$1
fi

if test $cont = 0 ; then
    echo $commit > $cherry_commit
    git cherry-pick -n $commit
fi

git log -1 $commit | git commit -F -
rm -f $cherry_commit
